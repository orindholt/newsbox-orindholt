"on"==localStorage.darkmode&&document.querySelector("body").classList.add("dark-theme");let cardStorage=localStorage.cards?JSON.parse(localStorage.cards):[];const key="CsZGAx8GwP1dlmWuflb94puYcOmdpaXP",sections=[];cardStorage.forEach(t=>sections.push(t.section));const idArray=[];cardStorage.forEach(t=>idArray.push(t.id));const categories=shortenArr(sections),ax=t=>{t=`https://api.nytimes.com/svc/topstories/v2/${t}.json?api-key=`+key;return axios(t,{mode:"cors"}).then(t=>t.data.results)};function shortenStr(t,e){return t.length<=e?t:t.substr(0,t.lastIndexOf(" ",e))}function shortenArr(t){const e=[];return t.forEach(t=>{e.includes(t)||e.push(t)}),e}categories.length||(document.querySelector("#main").innerHTML='<p class="ta-center">Sorry, nothing here..</p>'),categories.forEach(t=>{let a=document.createElement("section");a.classList.add("Section"),document.querySelector("#main").append(a),a.innerHTML+=`
    <div class="d-f gap-3 p-2  bt-1-ice ai-center">
        <div class="Section__icon br-full d-f jc-center ai-center">
            <img src="./assets/icn_surfing.svg" alt="Header Icon" class="w-auto">
        </div>
        <h2 class="Section__header">${t}</h2>
        <button class="ml-auto Section__btn show-hide"><i class="fas fa-chevron-down Section__chevron"></i></button>
    </div>`;let r=0,s=document.createElement("div");s.classList.add("Card__container"),a.append(s),ax(t).then(t=>{t.forEach(e=>{"admin"!=e.section&&idArray.includes(e.short_url)?(s.innerHTML+=`
                <article class="Card" id="${e.short_url}"
                data-section="${a.querySelector(".Section__header").textContent}">
                    <button class="Card__btn Card__btn_delete"><i class="fas fa-trash fs-l text-snow"></i></button>
                    <div class="Card__text  p-2">
                        <img src="${e.multimedia[0].url}" class="Card__img">
                        <div>
                            <h3 class="Card__title">${e.title}</h3>
                            <p class="Card__abstract">${shortenStr(e.abstract,30)}...</p>
                        </div>
                    </div>
                </article>`,r+=100,s.style.maxHeight=r+"px"):(cardStorage=cardStorage.filter(t=>e.short_url!=t.id),localStorage.setItem("cards",JSON.stringify(cardStorage)))})}).catch(e=>{if(e.status){let t=e.response;document.querySelector("#main").innerHTML=`<p class="ta-center">
                Error: ${t.status.toString()} (${t.statusText})<br>
                ${429==t.status?"Please wait awhile before reloading the page..":""}
            </p>`}})}),document.querySelector(".Main").addEventListener("touchstart",o=>{let n=o.target.parentElement,c=o.target.closest(".Card");if(n.classList.contains("Card__text")||n.parentElement.classList.contains("Card__text")){n=o.target.closest(".Card__text");let e=Math.floor(o.touches[0].clientX),a,r=c.querySelector(".Card__btn"),s=r.offsetWidth;n.addEventListener("touchmove",t=>{a=Math.floor(t.touches[0].clientX),a<e&&a>e-s&&(n.style.transform=`translateX(${a-e}px)`)}),n.addEventListener("touchend",()=>{a<e-s/3?n.style.transform=`translateX(-${s}px)`:n.style.transform="translateX(0px)"}),r.onclick=()=>{r.disabled=!0,cardStorage=cardStorage.filter(t=>c.id!=t.id),localStorage.setItem("cards",JSON.stringify(cardStorage)),JSON.parse(localStorage.cards).length||(localStorage.removeItem("cards"),document.querySelector("#main").innerHTML='<p class="ta-center">Sorry, nothing here..</p>'),Toastify({className:"Toast_delete",text:`'${shortenStr(c.querySelector(".Card__title").textContent,20)}...' was removed from archived.`,duration:3e3,stopOnFocus:!1,gravity:"top",position:"center"}).showToast(),c.classList.add("del-animation"),c.style.pointerEvents="none";let t=c.closest(".Card__container");t.style.maxHeight=t.offsetHeight-100+"px",setTimeout(()=>{c.remove()},1200)}}else n.classList.contains("show-hide")&&(n.onclick=()=>{let t=o.target.closest(".Section"),e=t.querySelector(".Card__container");"rotate(-90deg)"!=o.target.style.transform?(o.target.style.transform="rotate(-90deg)",e.style.pointerEvents="none",e.classList.remove("show-animation"),e.classList.add("hide-animation")):(o.target.style.transform="rotate(0deg)",e.style.pointerEvents="auto",e.classList.remove("hide-animation"),e.classList.add("show-animation"))})});