let cardStorage=localStorage.cards?JSON.parse(localStorage.cards):[];const key="CsZGAx8GwP1dlmWuflb94puYcOmdpaXP",categories=["world","health","sports","business","travel"],idArray=[];cardStorage.forEach(t=>idArray.push(t.id));const ax=t=>{t=`https://api.nytimes.com/svc/topstories/v2/${t}.json?api-key=`+key;return axios(t,{mode:"cors"}).then(t=>t.data.results)};function shortenStr(t,e){return t.length<=e?t:t.substr(0,t.lastIndexOf(" ",e))}categories.forEach(t=>{if("off"!=localStorage[""+t]){let e=document.createElement("section");e.classList.add("Section"),document.querySelector("#main").append(e),e.innerHTML+=`
        <div class="d-f gap-3 p-2 bb-1-ice bt-1-ice ai-center">
            <div class="Section__icon br-full d-f jc-center ai-center">
                <img src="./assets/icn_surfing.svg" alt="Header Icon" class="w-auto">
            </div>
            <h2 class="Section__header">${t}</h2>
            <button class="ml-auto Section__btn show-hide"><i class="fas fa-chevron-down"></i></button>
        </div>`;let a=0,s=document.createElement("div");s.classList.add("Card__container"),e.append(s),ax(t).then(t=>{t.forEach(t=>{"admin"!=t.section&&!idArray.includes(t.short_url)&&t.multimedia&&t.abstract&&(s.innerHTML+=`
                    <article class="Card" id="${t.short_url}"
                    data-section="${e.querySelector(".Section__header").textContent}">
                        <button class="Card__btn bg-sage"><i class="fas fa-inbox fs-l text-snow"></i></button>
                        <div class="Card__text bg-snow p-2">
                            <img src="${t.multimedia[0].url}" class="Card__img">
                            <div>
                                <h3 class="Card__title">${t.title}</h3>
                                <p class="Card__abstract">${shortenStr(t.abstract,30)}...</p>
                            </div>
                        </div>
                    </article>`,a+=100,s.style.maxHeight=a+"px")})}).catch(e=>{if(e.status){let t=e.response;document.querySelector("#main").innerHTML=`<p class="ta-center">
                    Error: ${t.status.toString()} (${t.statusText})<br>
                    ${429==t.status?"Please wait awhile before reloading the page..":""}
                </p>`}})}}),document.querySelector(".Main").addEventListener("touchstart",n=>{let o=n.target.parentElement,i=n.target.closest(".Card");if(o.classList.contains("Card__text")||o.parentElement.classList.contains("Card__text")){o=n.target.closest(".Card__text");let e=Math.floor(n.touches[0].clientX),a,s=i.querySelector(".Card__btn"),r=s.offsetWidth;o.addEventListener("touchmove",t=>{a=Math.floor(t.touches[0].clientX),a<e&&a>e-r&&(o.style.transform=`translateX(${a-e}px)`)}),o.addEventListener("touchend",()=>{a<e-r/3?o.style.transform=`translateX(-${r}px)`:o.style.transform="translateX(0px)"}),s.onclick=()=>{s.disabled=!0;var t={id:i.id,section:i.getAttribute("data-section")};cardStorage.push(t),localStorage.cards=JSON.stringify(cardStorage),i.classList.add("del-animation"),i.style.pointerEvents="none";let e=i.closest(".Card__container");e.style.maxHeight=e.offsetHeight-100+"px",setTimeout(()=>{i.remove()},1200)}}else o.classList.contains("show-hide")&&(o.onclick=()=>{let t=n.target.closest(".Section"),e=t.querySelector(".Card__container");"rotate(-90deg)"!=n.target.style.transform?(n.target.style.transform="rotate(-90deg)",e.style.pointerEvents="none",e.classList.remove("show-animation"),e.classList.add("hide-animation")):(n.target.style.transform="rotate(0deg)",e.style.pointerEvents="auto",e.classList.remove("hide-animation"),e.classList.add("show-animation"))})});